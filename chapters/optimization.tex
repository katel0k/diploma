

\section{Анализ узкого места}
Исходная реализация:
\begin{lstlisting}
let render buffer = 
  ...
  Buffer.add_string buffer (Buffer.contents local_buffer)
\end{lstlisting}

\textbf{Проблема}: создание временного буфера для каждого компонента → O(n) аллокаций.

\section{Механизм пула буферов}
Предложенное решение:
\begin{lstlisting}
let buffer_pool = Array.init 100 (fun _ -> Buffer.create 1024)

let with_buffer fn =
  let buf = Array.get buffer_pool (Random.int 100) in
  Buffer.clear buf;
  fn buf
\end{lstlisting}

\textbf{Эффект}:
\begin{itemize}
    \item Константное число аллокаций (при инициализации)
    \item Сохранение чистоты функций
    \item Ускорение рендеринга в 3.8x
\end{itemize}